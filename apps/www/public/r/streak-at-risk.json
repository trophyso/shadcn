{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "streak-at-risk",
  "type": "registry:ui",
  "dependencies": [
    "class-variance-authority",
    "lucide-react"
  ],
  "registryDependencies": [],
  "files": [
    {
      "path": "components/ui/streak-at-risk.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { AlertTriangle, Flame, X } from \"lucide-react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Types (inlined)\ninterface StreakResponse {\n  length: number\n  frequency: \"daily\" | \"weekly\" | \"monthly\"\n  started: string | null\n  periodStart: string | null\n  periodEnd: string | null\n  expires: string | null\n  streakHistory: Array<{\n    periodStart: string\n    periodEnd: string\n    length: number\n    usedFreeze?: boolean\n  }>\n  rank: number | null\n  freezes?: number\n  maxFreezes?: number\n}\n\n// Helper to calculate time remaining until end of day\nfunction getTimeRemainingMs(expiresDate: string | null): number | null {\n  if (!expiresDate) return null\n\n  // expires is a date string (YYYY-MM-DD), assume end of day (23:59:59)\n  const expireDateTime = new Date(expiresDate + \"T23:59:59\")\n  const now = new Date()\n  const remaining = expireDateTime.getTime() - now.getTime()\n\n  return remaining > 0 ? remaining : 0\n}\n\n// Format time remaining\nfunction formatTimeRemaining(ms: number): string {\n  const hours = Math.floor(ms / (1000 * 60 * 60))\n  const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60))\n\n  if (hours > 24) {\n    const days = Math.floor(hours / 24)\n    return `${days}d ${hours % 24}h`\n  }\n  if (hours > 0) {\n    return `${hours}h ${minutes}m`\n  }\n  return `${minutes}m`\n}\n\n// Variants\nconst streakAtRiskVariants = cva(\n  \"flex items-center gap-3 rounded-lg border p-4 transition-colors\",\n  {\n    variants: {\n      variant: {\n        banner: \"w-full\",\n        toast: \"w-auto max-w-sm shadow-lg\",\n        inline: \"w-auto\",\n      },\n      severity: {\n        warning: \"border-yellow-500/50 bg-yellow-500/10 text-yellow-700 dark:text-yellow-400\",\n        critical: \"border-red-500/50 bg-red-500/10 text-red-700 dark:text-red-400\",\n      },\n    },\n    defaultVariants: {\n      variant: \"banner\",\n      severity: \"warning\",\n    },\n  }\n)\n\n// Props\ninterface StreakAtRiskProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    Omit<VariantProps<typeof streakAtRiskVariants>, \"severity\"> {\n  /** Trophy API streak response */\n  streak: StreakResponse\n  /** Hours threshold for warning state (default: 6) */\n  warningHours?: number\n  /** Hours threshold for critical state (default: 2) */\n  criticalHours?: number\n  /** Show countdown timer */\n  showCountdown?: boolean\n  /** Allow dismissing the alert */\n  dismissible?: boolean\n  /** Callback when dismissed */\n  onDismiss?: () => void\n  /** Callback when action button clicked */\n  onAction?: () => void\n  /** Label for action button */\n  actionLabel?: string\n}\n\nconst StreakAtRisk = React.forwardRef<HTMLDivElement, StreakAtRiskProps>(\n  (\n    {\n      className,\n      variant,\n      streak,\n      warningHours = 6,\n      criticalHours = 2,\n      showCountdown = true,\n      dismissible = false,\n      onDismiss,\n      onAction,\n      actionLabel = \"Keep streak alive\",\n      ...props\n    },\n    ref\n  ) => {\n    const [dismissed, setDismissed] = React.useState(false)\n    const [timeRemaining, setTimeRemaining] = React.useState<number | null>(\n      () => getTimeRemainingMs(streak.expires)\n    )\n\n    // Update countdown\n    React.useEffect(() => {\n      if (!showCountdown || !streak.expires) return\n\n      const interval = setInterval(() => {\n        setTimeRemaining(getTimeRemainingMs(streak.expires))\n      }, 60000) // Update every minute\n\n      return () => clearInterval(interval)\n    }, [showCountdown, streak.expires])\n\n    // Don't render if dismissed\n    if (dismissed) return null\n\n    // Don't render if no expiration or already expired\n    if (timeRemaining === null || timeRemaining <= 0) return null\n\n    const hoursRemaining = timeRemaining / (1000 * 60 * 60)\n\n    // Don't render if not at risk yet\n    if (hoursRemaining > warningHours) return null\n\n    const isCritical = hoursRemaining <= criticalHours\n    const severity = isCritical ? \"critical\" : \"warning\"\n\n    const handleDismiss = () => {\n      setDismissed(true)\n      onDismiss?.()\n    }\n\n    const Icon = isCritical ? AlertTriangle : Flame\n\n    return (\n      <div\n        ref={ref}\n        role=\"alert\"\n        className={cn(streakAtRiskVariants({ variant, severity }), className)}\n        {...props}\n      >\n        <Icon className=\"h-5 w-5 shrink-0\" />\n\n        <div className=\"flex-1 space-y-1\">\n          <p className=\"font-medium\">\n            {isCritical ? \"Streak expires soon!\" : \"Your streak is at risk\"}\n          </p>\n          {showCountdown && (\n            <p className=\"text-sm opacity-80\">\n              {formatTimeRemaining(timeRemaining)} remaining to extend your{\" \"}\n              {streak.length}-day streak\n            </p>\n          )}\n        </div>\n\n        {onAction && (\n          <button\n            type=\"button\"\n            onClick={onAction}\n            className={cn(\n              \"shrink-0 rounded-md px-3 py-1.5 text-sm font-medium transition-colors\",\n              isCritical\n                ? \"bg-red-500 text-white hover:bg-red-600\"\n                : \"bg-yellow-500 text-white hover:bg-yellow-600\"\n            )}\n          >\n            {actionLabel}\n          </button>\n        )}\n\n        {dismissible && (\n          <button\n            type=\"button\"\n            onClick={handleDismiss}\n            className=\"shrink-0 rounded-md p-1 opacity-70 hover:opacity-100 transition-opacity\"\n            aria-label=\"Dismiss\"\n          >\n            <X className=\"h-4 w-4\" />\n          </button>\n        )}\n      </div>\n    )\n  }\n)\nStreakAtRisk.displayName = \"StreakAtRisk\"\n\nexport { StreakAtRisk, streakAtRiskVariants }\nexport type { StreakAtRiskProps, StreakResponse }\n",
      "type": "registry:ui"
    }
  ]
}